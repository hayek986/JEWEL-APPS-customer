workflows:
  build-and-upload-ipa:
    name: Build and Upload IPA (Final Robust Method)
    environment:
      flutter: stable
      xcode: latest
    scripts:
      - flutter pub get
      - |
        # Step 1: Build the .app file
        echo "Building .app file..."
        flutter build ios --release --no-codesign
      - |
        # Step 2: Create the .ipa file manually in the root directory
        echo "Creating IPA manually..."
        cd build/ios/iphoneos/
        mkdir Payload
        mv Runner.app Payload/
        zip -r ../../../newhayekjewel.ipa Payload/
        cd ../../..
    artifacts:
      - newhayekjewel.ipa # This will save the IPA file to the Artifacts section
